{% extends "base.html" %}
{% load static %}

{% block title %}Chat{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'messages.css' %}">
{% endblock %}

{% block content %}
<div class="messages-page">

  <!-- Top actions -->
  <div class="d-flex justify-content-end gap-2 mb-2">
    <a href="{% url 'delete_chat' other_user.id %}"
       class="btn btn-outline-danger btn-sm">
      Delete Chat
    </a>
<div class="d-flex justify-content-end gap-2 mb-2">

  {% if is_blocker %}
    <!-- ONLY BLOCKER CAN UNBLOCK -->
    <a href="{% url 'unblock_user' other_user.id %}"
       class="btn btn-outline-success btn-sm">
      Unblock
    </a>

  {% elif not is_blocked %}
    <!-- ONLY SHOW BLOCK IF NO BLOCK EXISTS -->
    <a href="{% url 'block_user' other_user.id %}"
       class="btn btn-outline-secondary btn-sm">
      Block
    </a>
  {% endif %}

</div>


  </div>

  <h5 class="mb-3">Chat with {{ other_user.username }}</h5>

  <div class="card chat-card">
    <div class="card-body chat-body">

      {% for msg in messages %}
        {% if msg.sender == request.user %}
          <!-- SENT -->
          <div class="d-flex justify-content-end mb-2">
            <div class="chat-bubble sent">
              {{ msg.content }}
            </div>
          </div>
        {% else %}
          <!-- RECEIVED -->
          <div class="d-flex justify-content-start mb-2">
            <div class="chat-bubble received">
              {{ msg.content }}
            </div>
          </div>
        {% endif %}
      {% endfor %}

    </div>
                 <div class="card-footer">

  {% if is_blocked %}
    <div class="mb-0">
      Messaging is disabled because one of you has blocked the other.
    </div>
  {% else %}
    <form method="post" class="d-flex gap-2">
      {% csrf_token %}
      <input
        type="text"
        name="message"
        class="form-control"
        placeholder="Type a message..."
        required
      >
      <button class="btn btn-primary">Send</button>
    </form>
  {% endif %}

</div>


  </div>

</div>
{% endblock %}
