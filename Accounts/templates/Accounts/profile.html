{% extends "base.html" %}
{% load static %}
{% block content_width %}col-12{% endblock %}

{% block title %}Profile | {{ profile.user.username }}{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'accounts/css/mainprofile.css' %}">
{% endblock %}

{% block content %}

<div class="profile-container linkedin-layout">

  <!-- ===============================
       PROFILE HEADER CARD
       =============================== -->
  <div class="profile-header ultra-wide-card">

    <div class="profile-header-row">

      <!-- LEFT : AVATAR -->
      <div class="profile-left">
        {% if profile.profile_image %}
          <img src="{{ profile.profile_image.url }}" class="profile-avatar">
        {% else %}
          <div class="avatar-fallback">
            {{ profile.user.username|first|upper }}
          </div>
        {% endif %}
      </div>

      <!-- CENTER : DETAILS -->
      <div class="profile-center">
        <h1>{{ profile.user.get_full_name|default:profile.user.username }}</h1>
        <h3>{{ profile.headline }}</h3>
        <p class="location">{{ profile.location }}</p>

        {% if request.user == profile.user %}
          <a href="{% url 'edit_profile' %}" class="edit-btn">Edit profile</a>
        {% endif %}
      </div>

      <!-- RIGHT : FOLLOWERS / CONNECTIONS -->
      <div class="profile-right">
        <a href="{% url 'followers' %}" class="profile-btn">
          Followers <span>{{ followers_count }}</span>
        </a>

        <a href="{% url 'connections_list' %}" class="profile-btn">
          Connections <span>{{ connections_count }}</span>
        </a>
      </div>

    </div>

    <!-- DELETE BUTTON INSIDE FIRST CARD -->
    {% if request.user == profile.user %}
    <div class="delete-row">
      <form method="post"
            action="{% url 'delete_account' %}"
            onsubmit="return confirmDelete();">
        {% csrf_token %}
        <button type="submit" class="delete-btn">
          Delete Account
        </button>
      </form>
    </div>
    {% endif %}

  </div>
  <!-- ===============================
       END HEADER CARD
       =============================== -->


  <!-- ABOUT -->
  <div class="card ultra-wide-card">
    <h2>About</h2>
    <p>{{ profile.bio|default:"No bio added yet." }}</p>
  </div>

  <!-- SKILLS -->
  {% if skills_list %}
  <div class="card ultra-wide-card">
    <h2>Skills</h2>
    <div class="skills-list">
      {% for skill in skills_list %}
        <span class="skill-pill">{{ skill }}</span>
      {% endfor %}
    </div>
  </div>
  {% endif %}
<!-- EDUCATION -->
<div class="card ultra-wide-card">
  <div class="section-header">
    <h2>Education</h2>
    {% if request.user == profile.user %}
      <a href="{% url 'add_education' %}" class="add-inline-btn">+ Add</a>
    {% endif %}
  </div>

  {% for edu in educations %}
    <div class="item-row">
      <h4>{{ edu.degree }}</h4>
      <p class="muted">{{ edu.institution }}</p>

      {% if edu.field_of_study %}
        <p class="muted">{{ edu.field_of_study }}</p>
      {% endif %}

      <small>
        {{ edu.start_year }} –
        {% if edu.end_year %}{{ edu.end_year }}{% else %}Present{% endif %}
      </small>

      <p class="desc">{{ edu.description }}</p>

      {% if request.user == profile.user %}
        <a href="{% url 'edit_education' edu.id %}" class="edit-link">Edit</a>
      {% endif %}
    </div>
  {% empty %}
    <p class="muted">No education added yet.</p>
  {% endfor %}
</div>

  <!-- EXPERIENCE -->
  <div class="card ultra-wide-card">
    <div class="section-header">
      <h2>Experience</h2>
      {% if request.user == profile.user %}
        <a href="{% url 'add_experience' %}" class="add-inline-btn">+ Add</a>
      {% endif %}
    </div>

    {% for exp in experiences %}
      <div class="item-row">
        <h4>{{ exp.role }}</h4>
        <p class="muted">{{ exp.company }}</p>
        <small>
          {{ exp.start_date }} –
          {% if exp.end_date %}{{ exp.end_date }}{% else %}Present{% endif %}
        </small>
        <p class="desc">{{ exp.description }}</p>

        {% if request.user == profile.user %}
          <a href="{% url 'edit_experience' exp.id %}" class="edit-link">Edit</a>
        {% endif %}
      </div>
    {% empty %}
      <p class="muted">No experience added yet.</p>
    {% endfor %}
  </div>

  <!-- PROJECTS -->
  <div class="card ultra-wide-card">
    <div class="section-header">
      <h2>Projects</h2>
      {% if request.user == profile.user %}
        <a href="{% url 'add_project' %}" class="add-inline-btn">+ Add</a>
      {% endif %}
    </div>

    {% for proj in projects %}
      <div class="item-row">
        <h4>{{ proj.title }}</h4>
        <p class="desc">{{ proj.description }}</p>

        {% if proj.tech_stack %}
          <p class="muted">Tech: {{ proj.tech_stack }}</p>
        {% endif %}

        {% if proj.project_link %}
          <a href="{{ proj.project_link }}" target="_blank" class="project-link-btn">
  View project
</a>

        {% endif %}

        {% if request.user == profile.user %}
          <a href="{% url 'edit_project' proj.id %}" class="edit-link">Edit</a>
        {% endif %}
      </div>
    {% empty %}
      <p class="muted">No projects added yet.</p>
    {% endfor %}
  </div>

</div>

{% endblock %}
